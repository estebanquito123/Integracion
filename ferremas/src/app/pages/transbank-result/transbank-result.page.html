<!-- transbank-result.page.html -->
<ion-header>
  <ion-toolbar>
    <ion-title>Resultado del Pago</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div *ngIf="cargando">
    <ion-spinner></ion-spinner>
    <p>Verificando estado de la transacción...</p>
  </div>

  <div *ngIf="!cargando">
    <div *ngIf="estado === 'exito'">
      <h2>✅ ¡Pago exitoso!</h2>
      <p>Token: {{ datos.token_ws }}</p>

      <ion-card *ngIf="detallesTransaccion">
        <ion-card-header>
          <ion-card-title>Detalles de la transacción</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p><strong>Monto:</strong> ${{ detallesTransaccion.amount }}</p>
          <p><strong>Orden:</strong> {{ detallesTransaccion.buy_order }}</p>
          <p><strong>Tarjeta:</strong> **** **** **** {{ detallesTransaccion.card_detail?.card_number }}</p>
          <p><strong>Fecha:</strong> {{ detallesTransaccion.transaction_date }}</p>
        </ion-card-content>
      </ion-card>
    </div>

    <div *ngIf="estado === 'fallo'">
      <h2>❌ Pago fallido o cancelado</h2>
      <p>Token: {{ datos.TBK_TOKEN }}</p>
      <p>Orden de compra: {{ datos.TBK_ORDEN_COMPRA }}</p>

      <ion-button routerLink="/home">
        Volver al inicio
      </ion-button>
    </div>

    <div *ngIf="estado === 'desconocido'">
      <h2>⚠️ Estado de transacción no reconocido</h2>
      <p>Es posible que el usuario haya abortado el proceso.</p>

      <ion-button routerLink="/home">
        Volver al inicio
      </ion-button>
    </div>

    <hr />
    <p>Datos recibidos:</p>
    <pre>{{ datos | json }}</pre>

    <div *ngIf="detallesTransaccion">
      <p>Detalles de la transacción:</p>
      <pre>{{ detallesTransaccion | json }}</pre>
    </div>
  </div>
</ion-content>
