<ion-header>
  <ion-toolbar>
    <ion-title>Resultado del Pago</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div *ngIf="cargando">
    <ion-spinner></ion-spinner>
    <p>Verificando estado de la transacción...</p>
  </div>

  <div *ngIf="!cargando">
    <!-- Pago exitoso -->
    <div *ngIf="estado === 'exito'">
      <h2>✅ ¡Pago exitoso!</h2>
      <p><strong>Token:</strong> {{ datos.token_ws }}</p>

      <ion-card *ngIf="detallesTransaccion">
        <ion-card-header>
          <ion-card-title>Detalles de la transacción</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <p><strong>Monto:</strong> ${{ detallesTransaccion.amount }}</p>
          <p><strong>Orden:</strong> {{ detallesTransaccion.buy_order }}</p>
          <p><strong>Tarjeta:</strong> **** **** **** {{ detallesTransaccion.card_detail?.card_number }}</p>
          <p><strong>Fecha:</strong> {{ detallesTransaccion.transaction_date }}</p>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Pago fallido -->
    <div *ngIf="estado === 'fallo'">
      <h2>❌ El pago no fue autorizado</h2>
      <p>Token: {{ datos.TBK_TOKEN }}</p>
      <p>Orden de compra: {{ datos.TBK_ORDEN_COMPRA }}</p>

      <ion-button expand="block" color="danger" routerLink="/home">
        Volver al inicio
      </ion-button>
    </div>

    <!-- Estado desconocido -->
    <div *ngIf="estado === 'desconocido'">
      <h2>⚠️ No se pudo determinar el resultado del pago</h2>
      <p>Es posible que el proceso haya sido interrumpido o abortado por el usuario.</p>

      <ion-button expand="block" color="medium" routerLink="/home">
        Volver al inicio
      </ion-button>
    </div>

    <!-- Mostrar JSON para depuración (opcional) -->
    <hr />
    <ion-label color="medium"><strong>Datos recibidos:</strong></ion-label>
    <pre>{{ datos | json }}</pre>

    <div *ngIf="detallesTransaccion">
      <ion-label color="medium"><strong>Detalles:</strong></ion-label>
      <pre>{{ detallesTransaccion | json }}</pre>
    </div>
  </div>
</ion-content>
